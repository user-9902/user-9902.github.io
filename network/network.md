# 计算机网络

![](imgs\1745463710266.jpg)

## 什么是计算机网络

计算机网络的定义：将众多分散的、自治的计算机系统，通过通信设备、线路链接起来，组成网络。在该网络系统中可以实现资源的共享与信息传递。

计算机网络所围绕的核心问题是：**如何通过网络，将数据正确、可靠的从 A 传到 B**。



## 概念介绍

- 计算机网络：
  - 集线器/交换机：将多个网络中的结点链接起来，组成计算机网络。
- 互连网（internet：
  - 路由器：将两个或多个计算机网络连接起来，组成规模更大的计算机网络，称为互连网。
  - 通讯协议，内部协商。
- 互联网（Internet：
  - 也就所谓的公网，将全世界内的计算机网络组成起来的网络，ISP来提供组网服务。
  - 必须使用 tcp/ip 协议来通讯（大家使用一种语言）。

（拓展：家用路由器 与 路由器 的区别？ 家用路由器 = 路由器 + 交换机 + 其他功能）





## 计算机网络的组成

计算机网络的构成

- 硬件：主机（end system：电脑、服务器、手机）；通讯设备（交换机、调制解调器）；通讯链路（网线、光纤、同轴电缆）
- 软件：具体的应用程序（email客户端、聊天软件、机房nginx）
- 固件：预先烧录软件的软硬件（网卡固件）
- 协议：规定了软硬件的通讯规则（http、ftp）



##### 网络分类方式

重要性

- 核心：通讯设备+通讯链路，即提供连通性、交换服务的部分。
- 边缘：终端设备



- 资源子网：终端设备上共享的软硬件资源，主要指终端。
- 通讯子网：负责信息传输的部分，通讯设备+通讯链路+协议。





#### 计算机网络的功能

- 数据通讯：最基本、最重要的功能
- 资源共享：硬件、软件、数据资源
- 分布式处理：任务分发
- 提高可靠性：数据冗余
- 负载均衡：





## 分组交换

![](imgs\1726627547438.jpg)

​										（上图从左至右为： 电路交换 报文交换 分组交换）

在分组交换诞生之前，存在两种交换技术，电路交换，报文交换。

- 电路交换：

  即电话机网络，通过物理连接的方式以实现数据交换（交换中心接线员）。

  ​	优点：通讯双方独占线路资源，数据直连，通讯效率高。

  ​	缺点：建立/释放连接存在额外开销；线路独占，整个网络效率低；线路分配灵活性差；无差错处理。

- 报文交换：

​	即电报网络，直接将报文数据交给交换机，报文交换机负责存储转发。

​		优点：通讯双方无需建立链接；可以处理差错。

​		缺点：报文不定长，长报文存储转发开销大，出错重传代价高。

- 分组交换：

  参考了报文交换技术。通过对报文进行分组，解决了长报文的问题。

  ​	优点：分组定长，缓存开销小；重传代价低。

  ​	缺点：每个分组都需要存储控制信息（组号等），总的控制信息增加。

补充：虚拟电路交换：参考电路交换的分组交换技术。建立虚拟链接，分组传送报文。但其对分组管理的成本落在通讯设备上，通讯子网负担高。分组交换对分组的管理成本落在终端上。





**按分布范围分**

![](imgs\1726629357897.jpg)

| 名称            | 范围                           | 通讯协议 |
| --------------- | ------------------------------ | -------- |
| 广域网 WAN      | 几十千米-几千千米（跨省/国家） |          |
| 城域网 MAN      | 几千米-几十千米（城市间）      | 以太网   |
| 局域网 LAN      | 几十米-几千米  （学校/企业）   | 以太网   |
| 个域网 PAN WPAN | 几十米内（个人/家庭）          |          |



按传输技术分

广播式

点对点



按拓扑结构分类

| 结构       | 特点                                     | 案例         |
| ---------- | ---------------------------------------- | ------------ |
| 总线型结构 | 广播网络，存在总线竞争问题               | 集线器       |
| 环型结构   | 广播令牌在环中轮询                       | 令牌环网     |
| 星型结构   | 与中心设备点对点传输，不存在总线竞争问题 | 以太网交换机 |
| 网状结构   | 众多路由器构建                           | 广域网       |



按使用者

公网 专网



按传输介质

有线 无线





#### 计算机网络的性能

速率：网络上的节点在信道上传输数据的速率。（字节 B/s  比特 b/s

带宽：网络中信道所能通过的最高速率。（通讯工程中：带宽指的是频率范围

吞吐量：通过网络接口、信道的实际数据量



时延：发送时延 + 传播时延 + 处理时延 + 排队时延

时延带宽积：传播时延 * 带宽

往返时延：发送方发送完数据 + 发送方接受确认方确认 的总时间



信道利用率：信道有数据时间 / 总传输时间





## OSI & TCP/IP

![](imgs\1726648360605.jpg)

#### 层结构中的一些概念

实体：在分层结构中，在第n层活动的元素（软、硬件）通称为第n层实体，不同机器上同一层称为**对等层**，同一层的实体称为**对等实体**。

协议：控制**同层实体**间通讯的规则称为协议，协议是水平的。

服务：**下**层**为**相邻的**上**层提供的功能调用，服务是垂直的。

接口：上一层实体通过接口请求下一层实体的服务。



#### 实体间传输的单元

协议数据单元 PDU：对等层次间传送的数据单位。上一层数据 + 这一层控制信息

服务数据单元 SDU：对完成上一层实体所要求的功能而传送的数据。上一层的数据

协议控制单元 PCI：控制协议操作的信息。这一层控制信息



#### 协议的三要素

语法：数据、控制信息的格式

语义：需要发出何种控制信息、完成何种动作、做出何种应答

同步：执行各种操作的条件、时序关系



#### 标准OSI七层

| 层级       | 功能                                                         | 常见协议                    | 基本单位     | 常见设备/软件                                |
| ---------- | ------------------------------------------------------------ | --------------------------- | ------------ | -------------------------------------------- |
| 应用层     | 实现特定的网络应用                                           | HTTP、DNS、FTP、SMTP        | 报文         | 微信、浏览器                                 |
| 表示层     | **数据格式转换**：数据编码的转化、压缩解压缩、加解密         |                             | 报文         |                                              |
| 会话层     | **会话管理**                                                 | SSL、TLS                    | 报文         | VPN网关                                      |
| 传输层     | 实现端到端的通讯（即不同终端进程（端口）间的通讯）<br />**复用和分用**：多个高层实体可复用底层的连接 | TCP、UDP                    | 报文段       | 网关、负载均衡器                             |
| 网络层     | 分组转发：将报文进行**分组**，并转发出去<br />路由选择：维护路由表，决定分组到达目的地的路径<br />拥塞控制：<br />网际交互：实现异构网络互联<br />其他：差错控制（组的差错检查）、流量控制、链接建立于释放、可靠传输（确认信息） | IP、ICMP、ARP               | 数据报、分组 | 路由器                                       |
| 数据链路层 | 将比特流封装成**数据帧** <br />对数据帧进行**差错控制**<br />**流量控制** | PPP、以太网、VLAN、WLAN     | 帧           | 网桥：隔离两个网段<br />交换机：隔离多个网段 |
| 物理层     | 实现相邻节点间**比特流（光电信号）**的传输                   | IEEE820.1、USB  、Bluetooth | 比特         | 光纤、双绞线、同轴电缆、中继器、集线器       |





#### 实践中的四层TCP/IP

并不是所有的应用都需要会话保持、数据格式转换的功能，因此TCP/IP对此进行了精简。若需要会话管理、数据格式转换的功能，使用同样是应用层的特定协议即可。因此TCP/IP精简了会话层，表示层。

对硬件厂商来说，数据链路层和物理层的分层，降低了灵活性，抬高了成本。因此TCP/IP未对物理层，数据链路层作严格的规定。

OSI中为保证可靠性，数据链路层、网络层、传输层都存在流量控制、差错控制、连接管理（局部正确 != 全局正确）。TCP/IP则将这些功能交由传输层实现（全局正确 == 局部正确）。同时减少了大量网络层的计算，减少了网络核心设备的负载。

| 层级       | 功能                                           |      |
| ---------- | ---------------------------------------------- | ---- |
| 应用层     | 实现特定的网络应用                             |      |
| 传输层     | 实现端到端的通讯、流量控制、差错控制、连接管理 |      |
| 网络层     | 把分组从源节点发送至目的节点                   |      |
| 网络接口层 | 实现相邻节点间数据的传输（传输网络层的分组）   |      |





##  物理层

#### 信源、信宿、信号、信道

信源：数据发送方

信宿：数据接收方

信号：数据的载体。分为数字信号、模拟信号

信道：信号的通道

码元：一个信号周期内，可能出现 k 种信号，就是k进制码元。(若存在2种信号可以表示 0 和 1，即2进制码元，若存在 4 种可以表示00 01 10 11 ，即4进制码元)

​	波特率：码元/s 比特率：bit/s

信道的极限容量：

​	奈奎斯特定理：无噪声的信道的极限波特率 = $$2W$$(W为波特)；无噪声的信道的极限波特率 = $$ 2W log_2K$$2

​	香农定理：信噪比：$$S/N$$ (信号功率/噪声功率) 分贝记法的信噪比：$$10log_{10}S/N$$; 有噪声的极限比特率 = $$Wlog_2(1 + S/N)$$



#### 编码和调制

![](imgs\1732020260857.jpg)

数字电路中，对二进制数据的1和0，通常用高低电频来分别表示。有如下几种编码方式：

- 不归零编码 NRZ：简单的用低0高1表示。

  无自同步（连续的高（低）电频，无法区分

  节省带宽

  抗干扰能力差

- 归零编码 RZ：在每个信号周期中归0，方便区分一个完整的信号周期。

  自同步

  浪费带宽（两个周期表示一位数据

  抗干扰能力差

- 反向非归0编码 NRZI：每个信号周期开始时，若电压跳变的时候表示 0，不跳变则表示 1。

  自同步（增加冗余位，每8个周期增加一个冗余位

  节省带宽

  抗干扰能力差

- 曼彻斯特编码：每个信号周期中间，向电压下跳对应1，上跳表示0

  自同步

  浪费带宽

  抗干扰能力强

- 差分曼彻斯特编码：信号周期开始时，信号跳变则为0，否则表示1

  自同步

  浪费带宽

  抗干扰能力强

  
![](imgs\1732021514475.jpg)

模拟电路通过调频、调幅、调相来表示0或1。





#### 传输介质

有线介质（导向型介质）：

| 名称     | 组成                                                         | 以太网中的命名   |
| -------- | ------------------------------------------------------------ | ---------------- |
| 双绞线   | 由两根绞合到一起的线构成，网线便是由4组双绞线组成，（绞合的目的是为了抗电磁干扰。） | 10BaseT*         |
| 同轴电缆 | 由内导体+外导体屏蔽层，现已不常见。                          | 10Base5          |
| 光纤     | 由高反射率的纤心和低折射率的包层组成，以实现光信号的全反射，光纤对电磁信号不敏感，抗干扰能力强。 | 10BaseF* 2.5Gbps |

无线介质（非导向型介质）：

波长越长绕射性更好、波长越短指向性越好。

| 名称     | 组成                                                         |
| -------- | ------------------------------------------------------------ |
| 无线电波 | 长波，穿透性强，传输距离长，信号指向性弱。电信基站，wifi信号 |
| 微波     | 短波，频率高，指向性强，保密性差。卫星通讯                   |



#### 设备

| 名称   | 作用                                                         | 特性                     |
| ------ | ------------------------------------------------------------ | ------------------------ |
| 中继器 | 用以修正失真的信号，如 0.5-1.5V 为低频信号，4.5-5.5V为高频信号，中继器接受到低频信号，会将其整为1V,再转发。 | 半双工通讯               |
| 集线器 | 多端口的中继器，将一个端口的信号，广播出去。                 | 半双工通讯<br />共享带宽 |





## 数据链路层

#### 封装成帧

连续的比特流是不可靠的，将比特流分组，封装成帧，在此基础上我们才可以进行流量控制，差错控制等功能。一个数据帧由头尾控制消息，和数据组成。帧的长度受到MTU（最大传输单元）限制。

数据帧长度的控制

​	字符计数法：头消息中存储数据长度的消息，如  [5,a,b,c,d] [3,1,2]，该方法不可靠，因为当长度信息出错时，会导致后续的帧数据都发生错误。

​	字符填充法：用特定的字符表示帧的首尾，SOH，EOT。当数据中存在首位控制信息时，需要加上转义符特殊处理下，防止出错，这种转义处理称为透明传输。

​	零比特填充法：同字符填充一样，这里使用01111110表示数据帧的首尾边界。同时为了防止数据碰撞首尾标识，数据中出现连续的5个1则补0，即防止出现连续的6个1。

​	违规编码法：如曼彻斯特编码中，每个比特中存在电频的变化，不变化的比特信号是非法的，我们便可以使用非法的信号作为帧的边界。该方法常见。



#### 差错控制

计算机物理机器，受温度、湿度、电磁干扰等环境的影响，可能发生错误（0变成1，1变成0），这种单比特错误可能导致系统的运行出现问题。为了保证数据的正确性，计算机网络中存在着诸多的差错控制机制。如物理层中，中继器稳定电压的功能，就是一种差错控制的作用。而在数链层中，同样有着差错控制机制，其差错控制是基于编码的，如下：

检错编码

​	奇偶检验法：每n-1位信息后补**一位奇偶信息位**。标识n位数据中有奇数或偶数个1，但当错误>1时，就无法有效校验了。 

​	CRC循环冗余：通讯双方先约定一个多项式，将原数与约定多项式据进行**模二除法的余数**作为校验信息，添加至原数据后。

纠错编码

​	海明码：多比特数据进行**分组**，统计其每一组的奇偶性。数据量为n时，需要 k 位校验码，其中 $$2^k >= 2^n$$ 。校验码插入到源数据中的 0 1 2 4 8 ... 的位置，校验位与其与运算 >0 的数据位于同一组，值为奇偶校验的结果。



#### 流量控制

计算机处理数据的性能存在着差异，当一个性能强的机器发出的数据量，超过了接收方的处理能力时，就可能出现数据异常的情况，为此，数链层提供了**点到点的流量控制**机制。

停止等待协议：

发送方的发送队列长度只有一，发完一帧数据后，等待接受方的确认帧，再发送下一帧。

GBN协议：

发送的队列长度为n，可以连续发送队列内的数据，接收方可以合并多个帧的确认帧（累计确认），但同时带来了新的问题，当数据帧丢失时，会发生批量重传。

选择重传协议（SR）：

GBN协议中发生帧丢失时，后续的帧被丢弃，SR为接收方也设置了一个窗口，



#### 信道划分 介质访问控制

介质访问控制即，采取一定的手段，使得多节点在竞争信道资源时不会互相影响。

- 介质访问控制
  - 静态介质访问控制：共享信道的空间或时间。
    - 频分多路复用 FDM：将带宽划分为不同频道的子信道，每个子信道可以并行传输信号。
    - 时分多路复用 TDM：两个以上的信号，轮流使用物理信道。
    - 统计时分多路复用 STDM：在TDM的基础上，按照需求，动态分配时段。
    - 波分多路复用 WDM：波长的不同的光信号，互不干扰。
    - 码分多路复用 CDM：将多个信道的数据混到一起运输，到达后再分开。
  - 动态介质访问控制：不共享信道的时间空间。
    - 随机访问介质控制
      - ALOHA协议：随机发送，发送方接受不到ack帧，就是可能发生冲突，需要重传。
      - CSMA协议：监听信道是否空闲，空闲则直接发送，否则延迟。检测存在延迟，可能发生冲突。
      - CSMA/CD协议：CSMA的基础上，增加碰撞检测，发生碰撞后第t次后则在 $$[0,...,2^{t-1}]$$ 范围内随机间隔后重发。
        - 最小帧问题：若发送碰撞，需要阻断继续发送，但如果帧数据过小，可能阻断前就发送完了，因此以太网规定了最小帧64B
      - CSMA/CA协议：CSMA/CD是用于有线局域网的，发送方在信道空闲时发送请求发送帧，接收方响应接受帧，发送方再发送数据。
    - 轮询访问介质控制：静态介质访问控制不能独享带宽，随机访问介质控制可能发送冲突。
      - 令牌传递协议：环状网中，令牌由专门的信息块组成，需要发送消息的节点，需要持有令牌，发送完数据再放回环中。（令牌可能在传输中破损，导致所有节点无法发送消息）
      - 轮询协议：需要设置主节点，主节点邀请从节点发送。



#### 以太网

以太网是一种局域网技术，由于其造价低廉，现已在各种局域网技术中占据统治地位。

特点：

- 以太网使用CSMA/CD技术。

- 无连接：接收方、发送方无握手过程

- 不可靠：不对发送的数据编号，差错帧直接丢弃，差错控制交由上层控制。

- 网络拓扑结构为星形

- 采用曼彻斯特编码

- 局域网中硬件设备的地址称为物理地址或MAC地址。

  全球唯一的48位二进制地址

  MAC帧：8B前导码（7B同步码+1B帧开始定界符） + 64B数据码（ 6位目的地址+6位源地址+2位类型+46-1500位数据报文+4位FCS(CRC) ）



#### 无线局域网

无线局域（WLAN）网在局部区域内以无线电作为传输介质通讯的网络。

特点：

- MAC帧：

  6 + 6 + 2 + 46-1500 + FCS 

  目的地址 + 源地址 + 类型 + 数据 + FCS



#### VLAN

在传统局域网技术中，有诸多局限性，如：缺乏流量管理，广播流量会跨越整个网络；用户的管理不方便，需要改变物理线路布局；路由成本高。VLAN虚拟局域网技术可以解决了以上的问题。

特点：

- 交换机上，存有终端设备的MAC地址和端口的映射表。VLAN的实现，需要交换机额外存储一张VLAN ID与端口的映射表。

- VLAN之间需要借助三层交换机或路由器实现互相访问。

- VLAN帧：MAC地址的基础上添加 VLAN 帧

  6 + 6 + 4 + 2 + 46-1500 + FCS

  目的地址 + 源地址 + VLAN标记 + 类型 + 数据 + FCS

  



#### PPP协议

PPP协议点对点协议，是目前最广泛的广域网数据链路层协议。

特点：

- 将IP数据报封装到串行的链路当中

- 身份验证：链路控制协议LCP

- 实现网络层的连接：网络控制协议NCP

- PPP帧：

  1 + 1 + 1 + 2 + 1-1500 + 2 + 1

  定界符 + 占位 + 占位 + 协议 + 信息内容 + FCS + 定界符 





## 网络层

#### 路由选择与分组转发

#### 异构网络互联

#### ip协议

- IP协议是用于将多个分组交换网络连接起来的最典型的协议，一个IP数据包包括。数据平面、控制平面

  - 控制平面包含具体的控制协议 RIP OSTP 等

    

    ​		应用平面：路由选择 复杂均衡

    ​			↕ 北向接口

    东西接口 ↔ 控制平面： SDN控制器

    ​			↕ 南向接口 openflow协议

    ​		数据平面：路由转发

#### 拥塞控制

- ICMP

#### IPv4

- 

- ip分组格式 4 + 

- 辅助协议

  - ARP：ip地址到mac的转换
  - RARP：淘汰
  - DHCP：自动分配IP 。四次交换 DHCP发现 → DHCP提供 → DHCP请求 → DHCP确认
  - ICMP
    - 差错报告
      - 终点不可达：
      - 源点异质：
      - 超时：规定时间内没有收到所有的分片
      - 重定向：网络中有更多的
    - 询问报告
      - 回送请求：
      - 时间戳：追踪路由

- #### IPv6：解决IPv4地址耗尽的问题

  - 和IPv4的区别
    - 地址长为10B。零压缩连续的0用 :: 双冒号表示
    - 取消首部长度，设为定长
    - 去除分片
    - 取消检验和
  - 兼容
    - 双协议栈
    - 隧道
    - 首部转换

- 路由算法

  |          | RIP                                                      | OSPF                                                         | BGP              |
  | -------- | -------------------------------------------------------- | ------------------------------------------------------------ | ---------------- |
  | 交换信息 | 全量路由信息                                             | 变化信息                                                     | 变化信息         |
  |          |                                                          |                                                              |                  |
  | 流程     | 和相邻路由器，定时交换。路由代价为简单的跳数，最大16跳。 | 交换增量信息，交换的路由信息会在网络中dfs遍历。洪泛网络会自动划分子网，迪杰斯特拉求最短路 | 只交换增量信息， |

  

  

#### 

网络层将数据报文进行分组，按照路由协议传输分组数据。路由协议是路由实现的核心机制之一，它确保了





​	

#### 设备

路由器
![](imgs\1732168730002.jpg)

## 传输层

#### 复用分用

计算机中运行着许多进程，不可能所有应用都去实现网络层的功能，传输层提供了复用分用技术，向两个主机进程之间的通信提供通用的数据传输服务。

发送方应用进程通过 TCP复用器 or UDP复用器 将数据封装成ip报文，在网络中传输，接受方接收到ip报文后将报文进行拆解，通过 TCP分用器 or UDP分用器将数据传到对应的接收端口，实现端到端的数据传输。

TCP UDP的通过端口号区分

- 端口号
  - 服务器使用的端口号
    - 熟知端口号 0 - 1023	端口对应的服务是有严格标准的，如 443-https 50-DNS 22-SSH
    - 登记端口号 1024 - 49152（2^16 - 2^14 - 1）	为软件厂商和开发组织预留的端口，需要申请
  - 客户端使用的端口号 49153 - 65535 (2^16 - 1) 	 操作系统为客户端应用自动分配的端口



#### UDP

用户数据报协议（User Datagram Protocol），是一种无连接的、不可靠的、面向报文的协议。

特点

- 面向**无连接**的不可靠的传输层协议。

- 不具备流量控制、拥塞控制、重传的机制。

- 可以实现 1对1 1对n n对n的数据传输。

- 首部8字节。

![](imgs\1732843370764.jpg)



#### TCP

传输控制协议（Transmission Control Protocol），是一种面向连接的、可靠的、基于字节流的协议。

特点

- 面向**连接**的可靠的传输层协议。
  - 超时重传
  - 确认机制
  - 面向字节

- 只能实现 1对1 的数据传输。

- 首部 20 - 64字节。

![](imgs\1732843327250.jpg)

- 流量控制
  - 超时重传

- 拥塞控制
  - 满开始，指数增加发送的数据量，当一个时间窗口内发送确认帧丢失的时候，说明发生拥塞了，将在数据量减至一半。

- 3次握手建立连接

  1. →    SYN=1，seq=x
  2. ←    SYN=1，ACK=1 ，ack=x+1 ，seq=y
  3. →    ACK=1，ack=y+1，seq=x+1

- 4次挥手释放连接

  1. →    FIN=1，seq=u
  2. ←    ACK=1，seq=v，ack=u+1   （服务端可能还有未处理完的数据需要发送给客户端，所有服务端没有立刻发起断开请求）
  3. ←    FIN=1，ACK=1，seq=w，ack=u+1
  4. →    ACK=1，seq=u+1，ack=w+1

- 保活机制 keepalive

  - 建立TCP连接的双方长时间无数据交互，触发保活机制，TCP发送探测报文，若有响应则刷新保活时间，若无响应则断开连接。






## 应用层



为网络层提供的服务

链路管理

流量控制

差错控制





















