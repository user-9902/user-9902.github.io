# Docker

## 什么是Docker

一个web服务由诸多应用组成（redis、jdk、mysql），当我们开发、维护该web服务时，需要维护组成该服务的诸多应用。这种复杂性，对开发、测试、运维的标准开发流程过程带来了挑战：如何保证服务在不同环境中的一致性、如何更高效的利用操作系统的资源等。



## 容器化的方案

### 虚拟机

为了能够将我们搭建好的环境，完整的从开发环境移植到测试环境、生产环境，我们需要一种容器技术。由于所有的应用都是运行在操作系统上的，自然我们就会想到虚拟机技术，通过虚拟机的镜像克隆来完成移植。

但虚拟机存在诸多不足：硬件资源浪费、启动慢等。



### docker的容器化

docker的诞生解决了虚拟机过于笨重的问题，docker将程序以及程序所需要的依赖打包到docker container，同时屏蔽了操作系统的差异。货物（程序）在集装箱（容器）里，无需关注其在哪艘船（操作系统）里。



## Docker是如何工作的

- 镜像（Image）：Docker 镜像是容器运行的模板。
- 容器（Container）：容器是镜像运行实例。
- 仓库（Repository）：存放镜像的仓库。

- dockerfile：我们编写的配置文件
      ↓ docker build
- image：打包后的镜像文件
      ↓ docker run
- container：运行的镜像实例



### docker的底层实现

NameSpace：Linux中的PID、IPC、网络等资源是全局的，而NameSpace机制是一种资源隔离方案，在该机制下这些资源就不再是全局的了，而是属于某个特定的NameSpace，各个NameSpace下的资源互不干扰，这就使得每个NameSpace看上去就像一个独立的操作系统一样。

Control groups：有了NameSpace技术可以实现资源隔离，但进程还是可以不受控的访问系统资源，比如CPU、内存、磁盘、网络等，为了控制容器中进程对资源的访问，Docker采用control groups技术(也就是cgroup)，有了cgroup就可以控制容器中进程对系统资源的消耗了，比如你可以限制某个容器使用内存的上限、可以在哪些CPU上运行等等。

